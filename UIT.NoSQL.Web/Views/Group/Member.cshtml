@model IEnumerable<UIT.NoSQL.Web.Models.ListUserModels>
@{
    Layout = null;
}
@{
    ViewBag.Title = "Member";
}
<script type="text/javascript">
    function remove(_fullname, _id){
        
        var confirm = window.confirm('Are you sure to remove ' + _fullname + ' ?');
        if (confirm == true) {
            $.post("/Group/RemoveMember", { id: _id }, function (data)
            {
                if (data == "success") {
                    $("#" + _id).remove();
                }
                alert(data);
            });
        }
    }

    function BeginChange(divID, currentRole) {
        document.getElementById(divID).style.visibility = "visible";
        document.getElementById(currentRole).style.visibility = "hidden";
    }

    function SaveChange(divID, currentRole, userGroupID) {
        document.getElementById(divID).style.visibility = "hidden";
        document.getElementById(currentRole).style.visibility = "visible";

        //save
        var url = "/Group/ChangeRole";
        $.post(url, getUserObject(userGroupID), function (data) {
            alert(data);
        });
    }

    function CancelChange(divID, currentRole) {
        document.getElementById(divID).style.visibility = "hidden";
        document.getElementById(currentRole).style.visibility = "visible";
    }

    function getUserObject(_userGroupID) {
        var _groupId = document.getElementById("hdID").value;
        var _role = document.getElementById("select " + _userGroupID).value;

        var qstr =
            {
                groupId: _groupId,
                userGroupID: _userGroupID,
                role: _role
            };

        return qstr;
    }
</script>

<h2>List Members</h2>
<input id="hdID" type="hidden" value="@TempData["GroupID"]" />

<br/>
<table>
    <tr style="background-color:White">
        <th width="20%">
            @Html.DisplayName("User Name")
        </th>
        <th  width="25%">
            @Html.DisplayName("Email Adress")
        </th>
        <th  width="25%">
            @Html.DisplayName("Full Name")
        </th>
        <th  width="20%">
            @Html.DisplayName("Role")
        </th>
        <th  width="10%">
            @Html.DisplayName("Remove")
        </th>
    </tr>

@foreach (var item in Model) {
    <tr id="@item.UserGroupID" style="background-color:White;border: 1px solid #DDDCDC">
        <td  width="20%">
            @Html.DisplayFor(modelItem => item.UserName)
        </td>
        <td  width="25%">
            @Html.DisplayFor(modelItem => item.Email)
        </td>
        <td  width="25%">
            @Html.DisplayFor(modelItem => item.FullName)
        </td>
        <td  width="20%">
            <div id="currentRole @item.UserGroupID" style="display:inline;">
                @Html.DisplayFor(modelItem => item.Role)
            <a href="javascript:{}" onclick="BeginChange('dropdownlist @item.UserGroupID', 'currentRole @item.UserGroupID')">Change</a>
            </div>

            <div id="dropdownlist @item.UserGroupID" style="visibility:hidden; display:inline;">
                <select id="select @item.UserGroupID">
                    <option>Manager</option>
                    <option>Member</option>
                </select>
                
            <a href="javascript:{}" onclick="SaveChange('dropdownlist @item.UserGroupID', 'currentRole @item.UserGroupID', '@item.UserGroupID')">Save</a>
            <a href="javascript:{}" onclick="CancelChange('dropdownlist @item.UserGroupID', 'currentRole @item.UserGroupID')">Cancel</a>
            </div>

        </td>
        <td  width="10%">
            <a href="javascript:{}" onclick="remove('@item.FullName', '@item.UserGroupID');">Remove</a>
        </td>
    </tr>
}
</table>
